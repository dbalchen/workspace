<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>RaterStatus.pl</title>
<link rev="made" href="mailto:" />
</head>

<style type="text/css">
<!--
/* default style sheet generated by perltidy */
body {background: #FFFFFF; color: #000000}
pre { color: #000000; 
      background: #F0F0F0;
      font-family: courier;
    } 

.c  { color: #228B22;} /* comment */
.cm { color: #000000;} /* comma */
.co { color: #000000;} /* colon */
.h  { color: #CD5555; font-weight:bold;} /* here-doc-target */
.hh { color: #CD5555; font-style:italic;} /* here-doc-text */
.i  { color: #00688B;} /* identifier */
.j  { color: #CD5555; font-weight:bold;} /* label */
.k  { color: #8B008B; font-weight:bold;} /* keyword */
.m  { color: #FF0000; font-weight:bold;} /* subroutine */
.n  { color: #B452CD;} /* numeric */
.p  { color: #000000;} /* paren */
.pd { color: #228B22; font-style:italic;} /* pod-text */
.pu { color: #000000;} /* punctuation */
.q  { color: #CD5555;} /* quote */
.s  { color: #000000;} /* structure */
.sc { color: #000000;} /* semicolon */
.v  { color: #B452CD;} /* v-string */
.w  { color: #000000;} /* bareword */
-->
</style>
<body style="background-color: white">
<a name="-top-"></a>
<h1>RaterStatus.pl</h1>

<p><a name="__index__"></a></p>
<!-- INDEX BEGIN -->

<ul>

	<ul>

		<li><a href="#raterstatus_pl">RaterStatus.pl</a></li>
		<ul>

			<li><a href="#author">AUTHOR</a></li>
			<li><a href="#synopsis">SYNOPSIS</a></li>
			<li><a href="#description">DESCRIPTION</a></li>
			<li><a href="#input_parameters">INPUT PARAMETERS</a></li>
			<li><a href="#required_parameter_pairs">REQUIRED PARAMETER PAIRS</a></li>
			<li><a href="#optional_parameter_pairs">OPTIONAL PARAMETER PAIRS</a></li>
			<li><a href="#exception_handler">Exception handler</a></li>
		</ul>

	</ul>

</ul>
<!-- INDEX END -->

<hr />
<pre>#!/opt/perl5/bin/perl

</pre><p></p>
<h2><a name="raterstatus_pl">RaterStatus.pl</a></h2>
<p>
</p>
<h3><a name="author">AUTHOR</a></h3>
<pre>
  Pete Chudykowski</pre>
<p>
</p>
<h3><a name="synopsis">SYNOPSIS</a></h3>
<pre>
  perl RaterStatus.pl MpsLib &lt;path&gt; night_start &lt;hour&gt; night_end &lt;hour&gt; 
                      SqlLib &lt;path&gt; sql_night &lt;file&gt; sql_day &lt;file&gt;
                      market &lt;market&gt; Log &lt;path&gt;
                      [op_job &lt;job&gt;] [op_sid &lt;db instance&gt;]
                      [op_user &lt;username&gt;] [op_pass &lt;password&gt;]</pre>
<p>
</p>
<h3><a name="description">DESCRIPTION</a></h3>
<pre>
  RaterStatus executable.
  Accepts command line argument list of RaterStatus properties.
  Formats the arguments into a hash.
  Initiates a RaterStatus object passing the argument hash to it.
  Calls the run_check method.
  If defined, prints the return string from run_check to STDOUT.</pre>
<p>
</p>
<h3><a name="input_parameters">INPUT PARAMETERS</a></h3>
<pre>
  The input parameters compose of a list of 'key-value' pairs.  The
  order, in which the pairs appear on the command line is arbitrary.</pre>
<p>
</p>
<h3><a name="required_parameter_pairs">REQUIRED PARAMETER PAIRS</a></h3>
<pre>
  MpsLib - Specifies absolute path to the root Monitor directory.
           This is the directory where Monitor.pm is located.
           
  night_start - The RaterStatus check behaves differently depending
                on whether it is executed during daytime or during
                nighttime.  This parameter specifies the hour in GMT
                that is considered the beginning of nighttime.
                
  night_end - The RaterStatus check behaves differently depending
              on whether it is executed during daytime or during
              nighttime.  This parameter specifies the hour in GMT
              that is considered the end of nighttime.</pre>
<pre>
  SqlLib - Specifies path to the SQL directory relative to MpsLib.
  
  sql_night - Name of the file in SqlLib containing the query 
              used by a nighttime check.
  
  sql_day - Name of the file in SqlLib containing the query used
            by a daytime check.
            
  market - Market on which the check is run.  Format: &quot;MXX&quot;  where
           XX is the two-digit market number.
        
  Log       - Location of the log directory.</pre>
<p>
</p>
<h3><a name="optional_parameter_pairs">OPTIONAL PARAMETER PAIRS</a></h3>
<pre>
 [op_job] - Sspecifies the job name that is the key to the operational
            tables query used for secure retrieval of the application 
            schema connection string.  E.g. &quot;MPSBOOT&quot;;  
            Required when the environment variable $OP_JOB_NAME is 
            undefined or set to an incorrect value. 
 
 [op_sid] - Specifies the database schema name of the operational
            database used for secure retrieval of the application
            schema connection string.
 
 [op_user] - Specifies the user name of the operational
             database used for secure retrieval of the application
             schema connection string.
 
 [op_pass &lt;password&gt;] - Specifies the password for the operational
                        database used for secure retrieval of the 
                        application schema connection string.</pre>
<pre>
<span class="k">use</span> <span class="w">strict</span><span class="sc">;</span>
<span class="k">use</span> <span class="w">warnings</span><span class="sc">;</span>

<span class="c"># Add the root Monitor path to @INC.</span>
<span class="k">BEGIN</span>
<span class="s">{</span>
    <span class="k">if</span> <span class="s">(</span><span class="i">@ARGV</span> % <span class="n">2</span> == <span class="n">1</span><span class="s">)</span>
    <span class="s">{</span>
        <span class="k">print</span> <span class="i">STDERR</span> <span class="q">&quot;\nUSAGE\n&quot;</span>
          . <span class="q">&quot;perl RaterStatus.pl MpsLib &lt;path&gt;\n&quot;</span>
          . <span class="q">&quot;                    night_start &lt;hour&gt;\n&quot;</span>
          . <span class="q">&quot;                    night_end &lt;hour&gt;\n&quot;</span>
          . <span class="q">&quot;                    SqlLib &lt;path&gt;\n&quot;</span>
          . <span class="q">&quot;                    sql_night &lt;file&gt;\n&quot;</span>
          . <span class="q">&quot;                    sql_day &lt;file&gt;\n&quot;</span>
          . <span class="q">&quot;                    market &lt;market&gt;\n&quot;</span>
          . <span class="q">&quot;                    [op_job &lt;job&gt;]\n&quot;</span>
          . <span class="q">&quot;                    [op_sid &lt;db instance&gt;]\n&quot;</span>
          . <span class="q">&quot;                    [op_user &lt;username&gt;]\n&quot;</span>
          . <span class="q">&quot;                    [op_pass &lt;password&gt;]\n\n&quot;</span><span class="sc">;</span>
        <span class="k">exit</span> <span class="n">-1</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">my</span> <span class="i">%args</span> = <span class="i">@ARGV</span><span class="sc">;</span>
    <span class="k">push</span> <span class="i">@INC</span><span class="cm">,</span> <span class="i">$args</span>{<span class="w">MpsLib</span>}<span class="sc">;</span>
<span class="s">}</span>

<span class="k">use</span> <span class="w">Carp</span><span class="sc">;</span>
<span class="k">use</span> <span class="w">Monitor::RaterStatus</span><span class="sc">;</span>
<span class="k">use</span> <span class="w">Logger</span><span class="sc">;</span>

<span class="c"># Flush output after every line.</span>
<span class="i">$|</span> = <span class="n">1</span><span class="sc">;</span>

<span class="c"># Convert input arguments into a hash</span>
<span class="k">my</span> <span class="i">%args</span> = <span class="i">@ARGV</span><span class="sc">;</span>

<span class="c"># Create Log file.</span>
<span class="k">my</span> <span class="i">$timestamp</span> = <span class="i">Logger::get_timestamp</span><span class="s">(</span><span class="q">&quot;%Y%m%d%H%M%S&quot;</span><span class="s">)</span><span class="sc">;</span>
<span class="k">my</span> <span class="i">$log</span>       =
  <span class="w">Logger</span><span class="w">-&gt;new</span><span class="s">(</span><span class="w">log_dir</span>  <span class="cm">=&gt;</span> <span class="i">$args</span>{<span class="w">MpsLib</span>} . <span class="i">$args</span>{<span class="w">Log</span>}<span class="cm">,</span>
              <span class="w">log_name</span> <span class="cm">=&gt;</span> <span class="q">&quot;RaterStatus_$timestamp.log&quot;</span><span class="s">)</span><span class="sc">;</span>
<span class="i">$log</span><span class="i">-&gt;print_to_log</span><span class="s">(</span><span class="i">$args</span>{<span class="w">title</span>}<span class="s">)</span> <span class="k">or</span> <span class="w">carp</span> <span class="q">&quot;Could not write to log.&quot;</span><span class="sc">;</span>

<span class="c"># instantiate RaterStatus object and run_check()</span>
<span class="k">my</span> <span class="i">$rater_status</span> = <span class="w">Monitor::RaterStatus</span><span class="w">-&gt;new</span><span class="s">(</span><span class="i">%args</span><span class="s">)</span><span class="sc">;</span>

<span class="k">eval</span> <span class="s">{</span>
    <span class="k">my</span> <span class="i">$result</span> = <span class="i">$rater_status</span><span class="i">-&gt;run_check</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
    <span class="k">if</span> <span class="s">(</span><span class="k">defined</span> <span class="i">$result</span><span class="s">)</span>
    <span class="s">{</span>
        <span class="i">$log</span><span class="i">-&gt;print_to_log</span><span class="s">(</span><span class="i">$result</span><span class="s">)</span><span class="sc">;</span>
        <span class="k">print</span> <span class="i">STDOUT</span> <span class="i">$result</span><span class="sc">;</span>
    <span class="s">}</span> <span class="k">else</span>
    <span class="s">{</span>
        <span class="i">$log</span><span class="i">-&gt;print_to_log</span><span class="s">(</span><span class="q">&quot;RaterStatus Error: Nothing Found!\n&quot;</span><span class="s">)</span><span class="sc">;</span>
        <span class="k">print</span> <span class="i">STDOUT</span> <span class="q">&quot;Nothing Found!\n&quot;</span><span class="sc">;</span>
    <span class="s">}</span>
<span class="s">}</span><span class="sc">;</span>

</pre><p></p>
<h3><a name="exception_handler">Exception handler</a></h3>
<pre>
    Catch exceptions, then die with a more personalized message and 
    a system call stack output.</pre>

<pre>
<span class="k">if</span> <span class="s">(</span><span class="i">$@</span><span class="s">)</span>
<span class="s">{</span>
    <span class="i">$log</span><span class="i">-&gt;print_to_log</span><span class="s">(</span><span class="q">&quot;Error in RaterStatus run_check method.&quot;</span><span class="s">)</span><span class="sc">;</span>
    <span class="w">carp</span> <span class="q">&quot;Error in RaterStatus run_check method.&quot;</span><span class="sc">;</span>
<span class="s">}</span>

<span class="i">$log</span><span class="i">-&gt;close_log</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
</pre></body>

</html>
